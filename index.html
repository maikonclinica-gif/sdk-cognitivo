<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>SDK Cognitivo</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    #chat { border: 1px solid #ccc; padding: 10px; height: 400px; overflow-y: auto; }
    .user { color: blue; margin: 5px 0; }
    .bot { color: black; margin: 5px 0; }
  </style>
</head>
<body>

<h2>SDK Cognitivo</h2>
<div id="session">sessions: loading...</div>
<button onclick="resetSession()">Reset sessão</button>

<div id="chat"></div>

<input id="input" placeholder="Digite sua mensagem..." style="width:80%">
<button onclick="send()">Enviar</button>

<script>
// ===== SESSION FIXA =====
let sessionId = localStorage.getItem("session_id");

if (!sessionId) {
  sessionId = crypto.randomUUID();
  localStorage.setItem("session_id", sessionId);
}

document.getElementById("session").innerText = "sessions: " + sessionId;

// ===== CHAT =====
function addMessage(text, cls) {
  const div = document.createElement("div");
  div.className = cls;
  div.innerText = text;
  document.getElementById("chat").appendChild(div);
}

async function send() {
  const input = document.getElementById("input");
  const msg = input.value;
  input.value = "";

  addMessage("Você: " + msg, "user");

  const res = await fetch("/chat", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({
      message: msg,
      session_id: sessionId
    })
  });

  const data = await res.json();
  addMessage("Bot: " + data.reply, "bot");
}

function resetSession() {
  localStorage.removeItem("session_id");
  location.reload();
}
</script>

</body>
</html>
